---
import type { CableSpec } from '../utils/cableData';
import { getMaxDataRate, getMaxPower } from '../utils/cableData';

export interface Props {
  cable: CableSpec;
  category: string;
}

const { cable, category } = Astro.props;

// Get primary protocol info for display
const primaryProtocol = Object.keys(cable.protocols)[0];
const primaryProtoInfo = cable.protocols[primaryProtocol];

// Format data rate for display
const maxRate = getMaxDataRate(cable);
function formatDataRate(mbps: number): string {
  if (mbps >= 1000) {
    return `${mbps / 1000} Gbps`;
  }
  return `${mbps} Mbps`;
}

const maxPower = getMaxPower(cable);
---

<div class="bg-white hover:shadow-lg hover:bg-blue-50 transition-shadow duration-200 border border-gray-300">
  <a href={`/${category}/${cable.type.toLowerCase().replace(/[^a-z0-9]/g, '-')}`} class="block p-6" aria-label={`View detailed specifications for ${cable.type}`}>
    <div class="flex justify-between items-start mb-4">
      <div>
        <h3 class="text-xl font-semibold text-gray-900 mb-1">{cable.type}</h3>
        <p class="text-gray-600">{cable.full_name}</p>
      </div>
      <div class="text-right">
        <span class="inline-block bg-slate-100 px-2 py-1 text-sm whitespace-nowrap text-slate-700 uppercase">
          {cable.standard_body}
        </span>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <p class="text-gray-500 uppercase tracking-wide">Max Speed</p>
        <p class="text-gray-900 font-medium">
          {formatDataRate(maxRate)}
        </p>
      </div>
      {maxPower && (
        <div>
          <p class="text-gray-500 uppercase tracking-wide">Max Power</p>
          <p class="text-gray-900 font-medium">
            {maxPower}W
          </p>
        </div>
      )}
    </div>

    <div class="mb-4">
      <p class="text-gray-500 uppercase tracking-wide mb-1">Connector</p>
      <p class="text-gray-900">
        {cable.connector.pins} pins, {cable.connector.width}×{cable.connector.height}mm
        {cable.connector.reversible && <span class="text-green-700 ml-1">(reversible)</span>}
      </p>
    </div>

    <div class="mb-4">
      <p class="text-gray-500 uppercase tracking-wide mb-1">Common Uses</p>
      <div class="flex flex-wrap gap-1">
        {cable.common_devices.slice(0, 3).map((device: string) => (
          <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700">
            {device}
          </span>
        ))}
        {cable.common_devices.length > 3 && (
          <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700">
            +{cable.common_devices.length - 3} more
          </span>
        )}
      </div>
    </div>

    {cable.confusion_points.length > 0 && (
      <div class="mb-4 p-2 bg-amber-50 border border-amber-200">
        <p class="text-amber-800 text-sm">
          ⚠️ {cable.confusion_points[0]}
        </p>
      </div>
    )}

    <p class="text-gray-600 line-clamp-2">{cable.notes}</p>
  </a>
</div>
